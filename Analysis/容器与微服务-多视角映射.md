# 容器与微服务：OS × vSphere/VMware × 容器 × 图灵机 多视角映射

## 1. 概述

- 主题：镜像/供给链、安全与策略、服务发现与网格、弹性与成本。

### 1.1 范围与边界（Scope & Non-goals）

- 定位：知识梳理/研究；非工程交付。
- 对标：Wikipedia、ACM/IEEE/USENIX、MIT/Stanford/CMU；Linux/FreeBSD、Kubernetes、Istio、VMware/NSX、IETF/IEEE 等。
- 证据：引用论文/标准/产品文档版本与节页。

## 2. OS 视角

- 命名空间/cgroups、LSM/seccomp、内核兼容与稳定接口、I/O/页缓存行为。

### 2.1 形式化定义与语义

- 隔离与权限：capabilities/LSM 的约束集合与不变式。

## 3. vSphere/VMware 视角

- VM 隔离 + 容器密度；资源池化/DRS；NSX 微分段；vSAN 存储策略。

### 3.1 对标特性与差异

- VM 级隔离（强边界）与容器级策略（细粒度）在合规/审计/多租户下的等价/非等价；Container-in-VM 的折中。
- vSphere 资源保留/限制/份额 与 K8s QoS（Guaranteed/Burstable/BestEffort）的映射与边界。
- NSX 微分段与 NetworkPolicy/Service Mesh 策略合成顺序；入口/南北向策略与 Ingress/Gateway 的职责边界（E-2025-0403/0010）。

### 3.1 对标特性与差异

- VM 级隔离与容器级策略的等价/非等价处，及合规边界。

## 4. 容器视角

- K8s 编排、镜像签名/SBOM、OPA/Gatekeeper、Service Mesh、HPA/KEDA、Node/Pod 安全。

### 4.1 K8s 运行时语义映射

- Pod/Service/Sidecar 与网络/策略/可观测性的语义对应。
- 供应链与策略：
  - 镜像签名/验证（cosign/Notary），策略引擎（OPA/Gatekeeper）对准 Admission；
  - RuntimeClass/安全上下文（seccomp/LSM/capabilities）形成端到端安全姿态（E-2025-0401）。

## 5. 图灵机视角

- 理论等价，实践取舍：层数/开销/安全边界/合规。

### 5.1 可计算性与复杂度

- 供应链验证与策略合成的复杂度关注点。

## 6. 多维映射（摘要）

| 维度 | OS | vSphere/VMware | 容器 | 备注 |
|---|---|---|---|---|
| 安全 | LSM/cap | NSX/隔离 | OPA/Policy/PSP→PSa | 端到端 |
| 成本 | 裸机密度 | 资源池化 | 弹性伸缩 | FinOps |
| 可靠 | 守护/重启 | HA/FT | PDB/重调度 | SLO 对齐 |
| 证据编号 | E-2025-0402 | E-2025-0403 | E-2025-0401/0010 | 对应参考 9 |

## 7. 建议

- Container-in-VM 作为安全与效率折中；供应链与策略统一为流水线，全面门禁与回放验证。
- 零信任默认拒绝：NetworkPolicy 最小权限，mesh mTLS 默认开启，命名空间级准入策略合规基线。

### 7.1 基准方法学（Benchmark Methodology）

- 指标：镜像拉取时延、冷启动、p95/p99、资源效率、SLO达标率。
- 方法：对照实验、回放流量、版本锁定、置信区间。
- 场景：镜像签名开关对启动时延影响；mTLS/Sidecar 开销对 p99 的影响；HPA/KEDA 弹性响应时间。

### 7.2 示例基线与面板

- 镜像与启动：`image_pull_seconds`、`container_start_time_seconds`，对比签名开/关（E-2025-0401）。
- 策略与网格：p99（RED 指标）叠加 mTLS/Sidecar 开销曲线；NetworkPolicy/NSX Traceflow 路径验证（E-2025-0403/0010）。
- 弹性与成本：HPA/KEDA 响应延迟与资源效率面板；按 SLO 预算进行 FinOps 权衡。

## 8. 相关目录链接

- `07-container-microservices/` 总览与各子章节
- `02-operating-systems/`（隔离/内核语义）
- `Analysis/DRS-与-K8s-调度对照与协同.md`

## 9. 参考与链接

- 论文/标准/产品手册：待补精确节页与版本（E-2025-0401/0402/0403/0010）。
- 证据落点占位：
  - E-2025-0401：供应链安全（签名/SBOM/策略）文档（章节/页待补）。
  - E-2025-0402：OS 隔离/内核接口稳定性与兼容性参考（节/页待补）。
  - E-2025-0403：vSphere/NSX/vSAN 与容器协同策略（节/页待补）。
  - E-2025-0010：K8s/NetworkPolicy/Ingress/Service（v1.30，节/页待补）。
