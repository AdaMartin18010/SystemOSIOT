# 分布式系统：OS × vSphere/VMware × 容器 × 图灵机 多视角映射

## 1. 概述

- 主题：一致性/容错/复制/调度/服务发现/存储/网络。
- 目标：跨层对齐功能语义、隔离与性能、治理与合规。

### 1.1 范围与边界（Scope & Non-goals）

- 定位：知识梳理/研究，对标国际课程与权威文献；非工程实现。
- 对标：Wikipedia、ACM/IEEE/USENIX、MIT/Stanford/CMU；Linux/FreeBSD、Kubernetes、Istio、VMware/NSX、IETF/IEEE 等。
- 证据：引用公开论文/标准/产品手册版本与节页，确保可复核。

## 2. OS 视角

- 进程/线程与 IPC、套接字、epoll/kqueue；磁盘/网络 I/O；时钟/定时器。
- 时钟不一致与 NTP/PTP；文件系统一致性与页缓存一致性注意。

### 2.1 形式化定义与语义

- 一致性语义：线性化/顺序一致/最终一致的前置/后置条件与不变式。
- 故障模型：崩溃/拜占庭的可达状态集与恢复约束。

## 3. vSphere/VMware 视角

- 资源池化与 HA/FT；vMotion 对分布式仲裁/心跳的影响；NSX 提供微分段与负载均衡。
- vSAN 提供分布式存储一致性策略；DRS 与分布式工作负载打散。

### 3.1 对标特性与差异

- vSAN 一致性策略 ↔ 数据库/对象存储一致性要求的等价/非等价处。
- DRS 迁移与一致性协议心跳/仲裁的时序耦合与约束。
 - NSX 负载均衡健康检查与服务发现/EndpointSlice 的一致性窗口；四层/七层转发与会话粘性对一致性语义的影响（E-2025-0103/0011）。

## 4. 容器视角

- K8s 编排：调度、亲和/反亲和、拓扑约束、Sidecar/Service Mesh、StatefulSet/PDB。
- 存储卷、网络策略、Ingress/Service、CNI/CSI；镜像与供给链。

### 4.1 K8s 运行时语义映射

- Pod/Service/Endpoints 与服务发现/负载均衡一致性假设的对应。
- PDB/HPA/重调度对副本一致性与可用性的影响边界。

## 5. 图灵机视角

- 一致性模型可被不同执行环境模拟；叠加层数影响延迟与抖动分布。

### 5.1 可计算性与复杂度

- 共识在异步有故障通道下不可判定事项与实际工程的近似策略。

## 6. 多维映射（摘要）

| 维度 | OS | vSphere/VMware | 容器 | 备注 |
|---|---|---|---|---|
| 一致性 | 本地+协议库 | vSAN/NSX 策略 | K8s/Operator | 端到端定义 |
| 容错 | 进程守护 | HA/FT | HPA/PDB/重调度 | 分层协作 |
| 调度 | CFS/RT | DRS | K8s 调度 | 避免冲突 |
| 安全 | LSM/ACL | NSX/策略 | NetworkPolicy/OPA | 策略即代码 |
| 观测 | eBPF | vCenter | OTel/mesh | 统一时间线 |
| 证据编号 | E-2025-0102 | E-2025-0103 | E-2025-0011 | 对应参考 9 |  

## 7. 建议

- 明确“分布式约束优先级”，避免 DRS 迁移动摇仲裁；对强一致集群设置固定亲和与维护窗口。
- 统一 SLO：延迟/可用性目标从应用到基础设施逐层分解。

### 7.1 基准方法学（Benchmark Methodology）

- 指标：吞吐、端到端 p50/p95/p99、抖动、可用性、恢复时间目标（RTO）。
- 设计：对照实验、事件回放、时钟对齐（NTP/PTP）、置信区间报告。
- 场景：DRS 迁移窗口对 RAFT 心跳与选举的影响；vSAN 策略变更对写放大与延迟分布的影响；NSX 四层/L7 策略对服务发现一致性的影响。

## 8. 相关目录链接

- `04-distributed-systems/` 总览与各子章节
- `05-cluster-systems/`（调度与资源管理关联）
- `08-network-systems/`（服务发现/负载均衡/策略）

## 9. 参考与链接

- 论文：Paxos/RAFT/VRR/Spanner/Calvin 关键论文（版本与页待补）（E-2025-0101）
- 标准/规范：POSIX 时钟/时间、PTP/NTP 协议（E-2025-0102）
- 产品手册：vSAN 一致性与策略、NSX 负载均衡与健康检查（E-2025-0103）
- K8s 文档：API Server/Controller/调度器、PDB/HPA/StatefulSet（v1.30）（E-2025-0011）
