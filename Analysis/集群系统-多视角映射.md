# 集群系统：OS × vSphere/VMware × 容器 × 图灵机 多视角映射

## 1. 概述

- 主题：批处理/并行计算、队列与配额、拓扑与亲和、吞吐与尾延迟。

## 2. OS 视角

- CPU/NUMA/IO 亲和；cgroups quota；I/O 调度；HugePage；内核参数与频率治理。

## 3. vSphere/VMware 视角

- 资源池/DRS 策略；保留/限制/份额；vMotion 带来的缓存冷却与性能回升时间。

### 3.1 对标特性与差异

- DRS 迁移对 L3/L4 缓存与 NUMA 亲和的影响窗口；与 OS 绑核/内存绑定的等价/非等价。
- vSphere 保留/限制/份额 与 K8s Guaranteed/Burstable/BestEffort QoS 的映射关系与边界。
- vMotion 对延迟敏感型队列：需要与作业调度维护窗口协同，避免尾延迟放大。

## 4. 容器视角

- K8s 调度、资源请求/限制、优先级抢占；GPU/SR-IOV/DPDK；DaemonSet/Job/CronJob。

## 5. 图灵机视角

- 算法层可移植；工程上需约束层数与抖动。

## 6. 多维映射（摘要）

| 维度 | OS | vSphere/VMware | 容器 | 备注 |
|---|---|---|---|---|
| 吞吐 | 绑核/批量 | DRS/超配控制 | 调度/批调优 | 端到端优化 |
| 尾延迟 | RT/隔离 | 保留/固定 | QoS/优先级 | 抖动抑制 |
| 成本 | 裸机密度 | 资源池财务化 | 自动伸缩 | 成本模型 |
| 证据编号 | E-2025-0602 | E-2025-0601 | E-2025-0011 | 对应 9 |

## 7. 建议

- 大作业批处理：容器优先，必要时容器 in VM；低延迟：VM 保留 + Pod 亲和。
- NUMA 感知：固定 CPU/内存亲和，容器侧设置 `topologyManager`；VM 映射物理 NUMA，避免远程访问。
- 迁移窗口：对延迟敏感队列设置维护窗口与“禁止迁移”策略；对批计算允许在队列空槽迁移。

### 7.1 基准方法学（Benchmark Methodology）

- 指标：吞吐、p95/p99、NUMA 远程访问比例、缓存命中率、迁移恢复时间（秒）。
- 设计：对照实验（固定/不固定亲和、保留/非保留、迁移/不迁移）；统一时间线与事件钉扎（E-2025-0301/0304）。
- 工具：Prometheus + eBPF（CPU/调度/软中断）、vCenter 事件、K8s 调度事件；回放脚本固化为工件。

## 8. 相关目录链接

## 9. 参考与链接

- vSphere/DRS/资源策略文档（E-2025-0601）
- K8s 调度器/批处理/优先级抢占/PDB 文档（E-2025-0011）
- OS/NUMA/CPUfreq/调度调优参考（E-2025-0602）

- `05-cluster-systems/` 总览与各子章节
- `07-container-microservices/`（编排与批处理）
- `02-operating-systems/`（NUMA/调度基础）
