# å®¹å™¨å¾®æœåŠ¡æŠ€æœ¯è·¯çº¿å›¾ä¸å®æ–½æŒ‡å— / Container Microservices Technology Roadmap and Implementation Guide

## æ¦‚è¿° / Overview

æœ¬æ–‡æ¡£æä¾›äº†å®¹å™¨ä¸å¾®æœåŠ¡æŠ€æœ¯çš„å‘å±•è·¯çº¿å›¾å’Œè¯¦ç»†å®æ–½æŒ‡å—ï¼Œæ—¨åœ¨ä¸ºå›¢é˜Ÿæä¾›æ¸…æ™°çš„æŠ€æœ¯æ¼”è¿›æ–¹å‘å’Œå…·ä½“çš„å®æ–½æ­¥éª¤ã€‚

This document provides a development roadmap and detailed implementation guide for container and microservice technologies, aiming to provide teams with a clear direction for technology evolution and specific implementation steps.

## ğŸ—ºï¸ æŠ€æœ¯è·¯çº¿å›¾ / Technology Roadmap

### é˜¶æ®µä¸€ï¼šåŸºç¡€è®¾æ–½ç°ä»£åŒ– (0-6ä¸ªæœˆ) / Phase 1: Infrastructure Modernization (0-6 months)

```mermaid
gantt
    title åŸºç¡€è®¾æ–½ç°ä»£åŒ–æ—¶é—´çº¿
    dateFormat  YYYY-MM-DD
    section å®¹å™¨åŒ–
    Dockerç¯å¢ƒæ­å»º     :done, docker, 2024-12-01, 2024-12-15
    é•œåƒä»“åº“å»ºè®¾       :done, registry, 2024-12-15, 2024-12-31
    å®‰å…¨æ‰«æé›†æˆ       :active, security, 2024-12-31, 2025-01-15
    
    section ç¼–æ’å¹³å°
    Kuberneteséƒ¨ç½²     :k8s, 2025-01-01, 2025-01-31
    ç½‘ç»œæ’ä»¶é…ç½®       :network, 2025-01-15, 2025-02-15
    å­˜å‚¨æ–¹æ¡ˆå®æ–½       :storage, 2025-02-01, 2025-02-28
    
    section ç›‘æ§ä½“ç³»
    Prometheuséƒ¨ç½²     :monitor, 2025-02-15, 2025-03-15
    æ—¥å¿—èšåˆç³»ç»Ÿ       :logging, 2025-03-01, 2025-03-31
    å‘Šè­¦æœºåˆ¶å»ºè®¾       :alert, 2025-03-15, 2025-04-15
```

**å…³é”®æˆæœç‰©**ï¼š

- âœ… æ ‡å‡†åŒ–å®¹å™¨é•œåƒ
- âœ… ç”Ÿäº§çº§Kubernetesé›†ç¾¤
- âœ… å®Œæ•´ç›‘æ§å‘Šè­¦ä½“ç³»
- âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²æµæ°´çº¿

### é˜¶æ®µäºŒï¼šå¾®æœåŠ¡æ¶æ„å®æ–½ (6-12ä¸ªæœˆ) / Phase 2: Microservices Architecture Implementation (6-12 months)

```mermaid
graph TD
    A[å•ä½“åº”ç”¨] --> B[æœåŠ¡æ‹†åˆ†è®¾è®¡]
    B --> C[APIç½‘å…³éƒ¨ç½²]
    C --> D[æœåŠ¡æ³¨å†Œå‘ç°]
    D --> E[é…ç½®ä¸­å¿ƒå»ºè®¾]
    E --> F[åˆ†å¸ƒå¼äº‹åŠ¡]
    F --> G[æ•°æ®ä¸€è‡´æ€§]
    G --> H[æœåŠ¡ç½‘æ ¼å¼•å…¥]
    H --> I[å¯è§‚æµ‹æ€§å¢å¼º]
    I --> J[æ²»ç†ç­–ç•¥å®Œå–„]
```

**å®æ–½ä¼˜å…ˆçº§**ï¼š

1. ğŸ”´ **é«˜ä¼˜å…ˆçº§**: APIç½‘å…³ã€æœåŠ¡æ³¨å†Œå‘ç°ã€é…ç½®ä¸­å¿ƒ
2. ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§**: åˆ†å¸ƒå¼äº‹åŠ¡ã€æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ
3. ğŸŸ¢ **ä½ä¼˜å…ˆçº§**: æœåŠ¡ç½‘æ ¼ã€é«˜çº§æ²»ç†åŠŸèƒ½

### é˜¶æ®µä¸‰ï¼šæ™ºèƒ½åŒ–è¿ç»´ (12-18ä¸ªæœˆ) / Phase 3: Intelligent Operations (12-18 months)

```mermaid
mindmap
  root((æ™ºèƒ½è¿ç»´))
    AIé©±åŠ¨
      å¼‚å¸¸æ£€æµ‹
      æ€§èƒ½é¢„æµ‹
      å®¹é‡è§„åˆ’
      æ•…éšœè‡ªæ„ˆ
    è‡ªåŠ¨åŒ–
      å¼¹æ€§ä¼¸ç¼©
      ç°åº¦å‘å¸ƒ
      æ•…éšœåˆ‡æ¢
      èµ„æºè°ƒåº¦
    å¯è§‚æµ‹æ€§
      å…¨é“¾è·¯è¿½è¸ª
      å®æ—¶ç›‘æ§
      æ ¹å› åˆ†æ
      ä¸šåŠ¡æ´å¯Ÿ
```

## ğŸ”§ å®æ–½æŒ‡å— / Implementation Guide

### 1. å®¹å™¨åŒ–æ”¹é€ æŒ‡å— / Containerization Guide

#### 1.1 åº”ç”¨å®¹å™¨åŒ–è¯„ä¼°

**è¯„ä¼°ç»´åº¦**ï¼š

```yaml
è¯„ä¼°æ¸…å•:
  æŠ€æœ¯å¯è¡Œæ€§:
    - ä¾èµ–é¡¹å¤æ‚åº¦: [ç®€å•/ä¸­ç­‰/å¤æ‚]
    - çŠ¶æ€å­˜å‚¨æ–¹å¼: [æ— çŠ¶æ€/æ–‡ä»¶çŠ¶æ€/æ•°æ®åº“çŠ¶æ€]
    - ç½‘ç»œé€šä¿¡æ¨¡å¼: [HTTP/TCP/UDP/æ··åˆ]
    - èµ„æºæ¶ˆè€—æƒ…å†µ: [CPUå¯†é›†å‹/å†…å­˜å¯†é›†å‹/IOå¯†é›†å‹]
  
  ä¸šåŠ¡å½±å“:
    - ç”¨æˆ·ä½“éªŒå½±å“: [æ— /è½»å¾®/æ˜¾è‘—]
    - æ•°æ®è¿ç§»å¤æ‚åº¦: [ç®€å•/ä¸­ç­‰/å¤æ‚]
    - åœæœºæ—¶é—´è¦æ±‚: [å¯æ¥å—/ä¸å¯æ¥å—]
    - å›æ»šé£é™©è¯„ä¼°: [ä½/ä¸­/é«˜]

  èµ„æºæŠ•å…¥:
    - å¼€å‘äººå‘˜æŠ€èƒ½: [ç†Ÿæ‚‰/ä¸€èˆ¬/ä¸ç†Ÿæ‚‰]
    - æ—¶é—´æŠ•å…¥ä¼°ç®—: [å¤©/å‘¨/æœˆ]
    - åŸºç¡€è®¾æ–½æˆæœ¬: [å¢åŠ /æŒå¹³/å‡å°‘]
    - åŸ¹è®­æˆæœ¬: [ä½/ä¸­/é«˜]
```

#### 1.2 å®¹å™¨åŒ–å®æ–½æ­¥éª¤

**æ­¥éª¤1: ç¯å¢ƒå‡†å¤‡**:

```bash
# 1. å®‰è£…Dockerç¯å¢ƒ
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 2. é…ç½®é•œåƒä»“åº“
docker login your-registry.com

# 3. è®¾ç½®å¼€å‘ç¯å¢ƒ
cat > Dockerfile.dev << EOF
FROM node:16-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=development
COPY . .
EXPOSE 3000
CMD ["npm", "run", "dev"]
EOF
```

**æ­¥éª¤2: é•œåƒæ„å»ºä¼˜åŒ–**:

```dockerfile
# å¤šé˜¶æ®µæ„å»ºç¤ºä¾‹
FROM node:16-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

FROM node:16-alpine AS runtime
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001
WORKDIR /app
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/package.json ./package.json
USER nextjs
EXPOSE 3000
CMD ["npm", "start"]
```

**æ­¥éª¤3: å®‰å…¨é…ç½®**:

```yaml
# kubernetes security context
apiVersion: v1
kind: Pod
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1001
    fsGroup: 2000
  containers:
  - name: app
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
        - ALL
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"
```

### 2. å¾®æœåŠ¡æ‹†åˆ†æŒ‡å— / Microservices Decomposition Guide

#### 2.1 æ‹†åˆ†ç­–ç•¥é€‰æ‹©

**æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†ï¼ˆæ¨èï¼‰**ï¼š

```mermaid
graph TB
    subgraph "ç”µå•†ç³»ç»Ÿ"
        A[ç”¨æˆ·ç®¡ç†æœåŠ¡]
        B[å•†å“ç›®å½•æœåŠ¡]
        C[è®¢å•å¤„ç†æœåŠ¡]
        D[æ”¯ä»˜æœåŠ¡]
        E[ç‰©æµæœåŠ¡]
        F[è¯„ä»·æœåŠ¡]
    end
    
    A --> C
    B --> C
    C --> D
    C --> E
    C --> F
```

**æ‹†åˆ†å†³ç­–çŸ©é˜µ**ï¼š

```yaml
è¯„ä¼°ç»´åº¦:
  ä¸šåŠ¡è¾¹ç•Œ:
    - åŠŸèƒ½å†…èšæ€§: [é«˜/ä¸­/ä½]
    - æ•°æ®å…³è”åº¦: [å¼º/ä¸­/å¼±]
    - å˜æ›´é¢‘ç‡: [é¢‘ç¹/ä¸€èˆ¬/ç¨³å®š]
    - å›¢é˜Ÿè¾¹ç•Œ: [æ˜ç¡®/æ¨¡ç³Š]
  
  æŠ€æœ¯è€ƒé‡:
    - æ€§èƒ½è¦æ±‚: [é«˜/ä¸­/ä½]
    - å¯ç”¨æ€§è¦æ±‚: [99.9%/99.95%/99.99%]
    - æ‰©å±•æ€§éœ€æ±‚: [æ°´å¹³/å‚ç›´/æ··åˆ]
    - æŠ€æœ¯æ ˆå·®å¼‚: [å¤§/ä¸­/å°]

  è¿ç»´å¤æ‚åº¦:
    - éƒ¨ç½²å¤æ‚åº¦: [ç®€å•/ä¸­ç­‰/å¤æ‚]
    - ç›‘æ§éš¾åº¦: [æ˜“/ä¸­/éš¾]
    - æ•…éšœæ’æŸ¥: [å®¹æ˜“/ä¸€èˆ¬/å›°éš¾]
    - æ•°æ®ä¸€è‡´æ€§: [å¼ºä¸€è‡´/æœ€ç»ˆä¸€è‡´/BASE]
```

#### 2.2 æœåŠ¡é—´é€šä¿¡è®¾è®¡

**åŒæ­¥é€šä¿¡æ¨¡å¼**ï¼š

```python
# RESTful APIè®¾è®¡
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel

app = FastAPI()

class UserRequest(BaseModel):
    username: str
    email: str

class UserResponse(BaseModel):
    id: int
    username: str
    email: str
    created_at: datetime

@app.post("/users", response_model=UserResponse)
async def create_user(user: UserRequest):
    # ç”¨æˆ·åˆ›å»ºé€»è¾‘
    pass

@app.get("/users/{user_id}", response_model=UserResponse)
async def get_user(user_id: int):
    # ç”¨æˆ·æŸ¥è¯¢é€»è¾‘
    pass
```

**å¼‚æ­¥é€šä¿¡æ¨¡å¼**ï¼š

```python
# äº‹ä»¶é©±åŠ¨æ¶æ„
import asyncio
from dataclasses import dataclass
from typing import List, Callable

@dataclass
class Event:
    type: str
    data: dict
    timestamp: datetime

class EventBus:
    def __init__(self):
        self.handlers: Dict[str, List[Callable]] = {}
    
    def subscribe(self, event_type: str, handler: Callable):
        if event_type not in self.handlers:
            self.handlers[event_type] = []
        self.handlers[event_type].append(handler)
    
    async def publish(self, event: Event):
        if event.type in self.handlers:
            tasks = [handler(event) for handler in self.handlers[event.type]]
            await asyncio.gather(*tasks)
```

### 3. æœåŠ¡ç½‘æ ¼å®æ–½æŒ‡å— / Service Mesh Implementation Guide

#### 3.1 Istioéƒ¨ç½²é…ç½®

**å®‰è£…Istio**ï¼š

```bash
# 1. ä¸‹è½½Istio
curl -L https://istio.io/downloadIstio | sh -
cd istio-*
export PATH=$PWD/bin:$PATH

# 2. å®‰è£…Istioæ§åˆ¶å¹³é¢
istioctl install --set values.defaultRevision=default

# 3. å¯ç”¨è‡ªåŠ¨æ³¨å…¥
kubectl label namespace default istio-injection=enabled
```

**æµé‡ç®¡ç†é…ç½®**ï¼š

```yaml
# VirtualServiceé…ç½®
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: productpage
spec:
  hosts:
  - productpage
  http:
  - match:
    - headers:
        canary:
          exact: "true"
    route:
    - destination:
        host: productpage
        subset: v2
      weight: 100
  - route:
    - destination:
        host: productpage
        subset: v1
      weight: 100
---
# DestinationRuleé…ç½®
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: productpage
spec:
  host: productpage
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
```

#### 3.2 å®‰å…¨ç­–ç•¥é…ç½®

**mTLSé…ç½®**ï¼š

```yaml
# å¯ç”¨ä¸¥æ ¼æ¨¡å¼mTLS
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: production
spec:
  mtls:
    mode: STRICT
---
# æˆæƒç­–ç•¥
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: productpage-viewer
  namespace: production
spec:
  selector:
    matchLabels:
      app: productpage
  rules:
  - from:
    - source:
        principals: ["cluster.local/ns/production/sa/bookinfo-productpage"]
  - to:
    - operation:
        methods: ["GET"]
```

### 4. ç›‘æ§å’Œå¯è§‚æµ‹æ€§æŒ‡å— / Monitoring and Observability Guide

#### 4.1 ç›‘æ§æ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        A[å¾®æœåŠ¡A] --> D[Metrics]
        B[å¾®æœåŠ¡B] --> D
        C[å¾®æœåŠ¡C] --> D
        A --> E[Traces]
        B --> E
        C --> E
        A --> F[Logs]
        B --> F
        C --> F
    end
    
    subgraph "æ”¶é›†å±‚"
        D --> G[Prometheus]
        E --> H[Jaeger]
        F --> I[ELK Stack]
    end
    
    subgraph "å±•ç¤ºå±‚"
        G --> J[Grafana]
        H --> J
        I --> J
        J --> K[å‘Šè­¦ç³»ç»Ÿ]
    end
```

#### 4.2 æŒ‡æ ‡ä½“ç³»è®¾è®¡

**åº”ç”¨æŒ‡æ ‡**ï¼š

```python
from prometheus_client import Counter, Histogram, Gauge, start_http_server
import time

# ä¸šåŠ¡æŒ‡æ ‡
REQUEST_COUNT = Counter('app_requests_total', 'Total requests', ['method', 'endpoint'])
REQUEST_LATENCY = Histogram('app_request_duration_seconds', 'Request latency')
ACTIVE_CONNECTIONS = Gauge('app_active_connections', 'Active connections')

# è£…é¥°å™¨ç”¨äºè‡ªåŠ¨è®°å½•æŒ‡æ ‡
def monitor_requests(func):
    def wrapper(*args, **kwargs):
        start_time = time.time()
        REQUEST_COUNT.labels(method='GET', endpoint='/api/users').inc()
        
        try:
            result = func(*args, **kwargs)
            return result
        finally:
            REQUEST_LATENCY.observe(time.time() - start_time)
    
    return wrapper

@monitor_requests
def get_users():
    # ä¸šåŠ¡é€»è¾‘
    pass
```

**ç³»ç»ŸæŒ‡æ ‡é…ç½®**ï¼š

```yaml
# Prometheusé…ç½®
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alert_rules.yml"

scrape_configs:
  - job_name: 'kubernetes-pods'
    kubernetes_sd_configs:
    - role: pod
    relabel_configs:
    - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
      action: keep
      regex: true
    - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
      action: replace
      target_label: __metrics_path__
      regex: (.+)

alerting:
  alertmanagers:
  - static_configs:
    - targets:
      - alertmanager:9093
```

#### 4.3 å‘Šè­¦è§„åˆ™é…ç½®

```yaml
# å‘Šè­¦è§„åˆ™ç¤ºä¾‹
groups:
- name: microservices.rules
  rules:
  - alert: HighErrorRate
    expr: |
      (
        rate(http_requests_total{status=~"5.."}[5m]) /
        rate(http_requests_total[5m])
      ) > 0.1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High error rate detected"
      description: "Error rate is {{ $value | humanizePercentage }} for service {{ $labels.service }}"

  - alert: HighLatency
    expr: |
      histogram_quantile(0.95,
        rate(http_request_duration_seconds_bucket[5m])
      ) > 0.5
    for: 10m
    labels:
      severity: critical
    annotations:
      summary: "High latency detected"
      description: "95th percentile latency is {{ $value }}s for service {{ $labels.service }}"
```

### 5. å®‰å…¨å®æ–½æŒ‡å— / Security Implementation Guide

#### 5.1 å®¹å™¨å®‰å…¨æœ€ä½³å®è·µ

**é•œåƒå®‰å…¨**ï¼š

```dockerfile
# ä½¿ç”¨æœ€å°åŒ–åŸºç¡€é•œåƒ
FROM alpine:3.18

# åˆ›å»ºéç‰¹æƒç”¨æˆ·
RUN addgroup -g 1001 -S appgroup && \
    adduser -u 1001 -S appuser -G appgroup

# å®‰è£…å¿…è¦çš„å®‰å…¨æ›´æ–°
RUN apk update && apk upgrade && \
    apk add --no-cache ca-certificates && \
    rm -rf /var/cache/apk/*

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
COPY --chown=appuser:appgroup app /app

# åˆ‡æ¢åˆ°éç‰¹æƒç”¨æˆ·
USER appuser

# è®¾ç½®åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ
VOLUME ["/tmp"]
```

**é•œåƒæ‰«ææµç¨‹**ï¼š

```bash
#!/bin/bash
# é•œåƒå®‰å…¨æ‰«æè„šæœ¬

IMAGE_NAME=$1
SCAN_RESULT_FILE="scan-results.json"

# ä½¿ç”¨Trivyæ‰«æé•œåƒ
trivy image --format json --output $SCAN_RESULT_FILE $IMAGE_NAME

# æ£€æŸ¥é«˜å±æ¼æ´
HIGH_VULNS=$(cat $SCAN_RESULT_FILE | jq '.Results[].Vulnerabilities[]? | select(.Severity=="HIGH") | length')
CRITICAL_VULNS=$(cat $SCAN_RESULT_FILE | jq '.Results[].Vulnerabilities[]? | select(.Severity=="CRITICAL") | length')

if [ "$CRITICAL_VULNS" -gt 0 ]; then
    echo "FAILED: Critical vulnerabilities found: $CRITICAL_VULNS"
    exit 1
elif [ "$HIGH_VULNS" -gt 5 ]; then
    echo "WARNING: High vulnerabilities found: $HIGH_VULNS"
    exit 1
else
    echo "PASSED: Security scan completed successfully"
    exit 0
fi
```

#### 5.2 Kuberneteså®‰å…¨é…ç½®

**Podå®‰å…¨ç­–ç•¥**ï¼š

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: secure-app
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1001
    runAsGroup: 3000
    fsGroup: 2000
    seccompProfile:
      type: RuntimeDefault
  containers:
  - name: app
    image: myapp:latest
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
        - ALL
        add:
        - NET_BIND_SERVICE
    volumeMounts:
    - name: tmp
      mountPath: /tmp
    - name: cache
      mountPath: /app/cache
  volumes:
  - name: tmp
    emptyDir: {}
  - name: cache
    emptyDir: {}
```

**ç½‘ç»œç­–ç•¥**ï¼š

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: app-network-policy
spec:
  podSelector:
    matchLabels:
      app: myapp
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: frontend
    - podSelector:
        matchLabels:
          role: api-gateway
    ports:
    - protocol: TCP
      port: 8080
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: database
    ports:
    - protocol: TCP
      port: 5432
  - to: []
    ports:
    - protocol: UDP
      port: 53
```

### 6. æ€§èƒ½ä¼˜åŒ–æŒ‡å— / Performance Optimization Guide

#### 6.1 å®¹å™¨æ€§èƒ½ä¼˜åŒ–

**èµ„æºé™åˆ¶ä¼˜åŒ–**ï¼š

```yaml
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: app
    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
      limits:
        memory: "512Mi"
        cpu: "500m"
    # JVMä¼˜åŒ–é…ç½®
    env:
    - name: JAVA_OPTS
      value: |
        -XX:InitialRAMPercentage=50.0
        -XX:MaxRAMPercentage=75.0
        -XX:+UseG1GC
        -XX:+UseContainerSupport
        -XX:MaxGCPauseMillis=200
```

**å¯åŠ¨æ—¶é—´ä¼˜åŒ–**ï¼š

```dockerfile
# å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
FROM maven:3.8-openjdk-17 AS builder
WORKDIR /app
COPY pom.xml .
RUN mvn dependency:go-offline -B
COPY src ./src
RUN mvn package -DskipTests

FROM openjdk:17-jre-slim
# ä½¿ç”¨AppCDSä¼˜åŒ–å¯åŠ¨æ—¶é—´
RUN java -Xshare:dump
COPY --from=builder /app/target/app.jar /app.jar
# é¢„ç¼–è¯‘çƒ­ç‚¹ä»£ç 
RUN java -XX:ArchiveClassesAtExit=app.jsa -jar /app.jar --warmup
ENTRYPOINT ["java", "-XX:SharedArchiveFile=app.jsa", "-jar", "/app.jar"]
```

#### 6.2 ç½‘ç»œæ€§èƒ½ä¼˜åŒ–

**æœåŠ¡ç½‘æ ¼ä¼˜åŒ–**ï¼š

```yaml
# Istioä»£ç†èµ„æºä¼˜åŒ–
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  values:
    global:
      proxy:
        resources:
          requests:
            cpu: 10m
            memory: 40Mi
          limits:
            cpu: 2000m
            memory: 1024Mi
    sidecarInjectorWebhook:
      defaultTemplates: [sidecar, builtin-gateway]
  meshConfig:
    defaultConfig:
      proxyStatsMatcher:
        inclusionRegexps:
        - ".*outlier_detection.*"
        - ".*circuit_breakers.*"
        - ".*upstream_rq_retry.*"
        - ".*_cx_.*"
        exclusionRegexps:
        - ".*osconfig.*"
```

### 7. æ•…éšœæ’æŸ¥æŒ‡å— / Troubleshooting Guide

#### 7.1 å¸¸è§é—®é¢˜è¯Šæ–­

**å®¹å™¨å¯åŠ¨å¤±è´¥**ï¼š

```bash
# 1. æ£€æŸ¥PodçŠ¶æ€
kubectl get pods -o wide

# 2. æŸ¥çœ‹è¯¦ç»†äº‹ä»¶
kubectl describe pod <pod-name>

# 3. æ£€æŸ¥å®¹å™¨æ—¥å¿—
kubectl logs <pod-name> -c <container-name> --previous

# 4. è¿›å…¥å®¹å™¨è°ƒè¯•
kubectl exec -it <pod-name> -- /bin/sh

# 5. æ£€æŸ¥èµ„æºä½¿ç”¨
kubectl top pods
kubectl top nodes
```

**ç½‘ç»œè¿æ¥é—®é¢˜**ï¼š

```bash
# 1. æ£€æŸ¥æœåŠ¡ç«¯ç‚¹
kubectl get endpoints <service-name>

# 2. æµ‹è¯•DNSè§£æ
kubectl run -it --rm debug --image=busybox --restart=Never -- nslookup <service-name>

# 3. æµ‹è¯•ç½‘ç»œè¿æ¥
kubectl run -it --rm debug --image=nicolaka/netshoot --restart=Never -- bash
# åœ¨å®¹å™¨å†…æ‰§è¡Œ
curl -v http://<service-name>:<port>
```

#### 7.2 æ€§èƒ½é—®é¢˜åˆ†æ

**CPUå’Œå†…å­˜åˆ†æ**ï¼š

```bash
# 1. æŸ¥çœ‹èµ„æºä½¿ç”¨è¶‹åŠ¿
kubectl top pods --sort-by=cpu
kubectl top pods --sort-by=memory

# 2. æ£€æŸ¥èµ„æºé™åˆ¶
kubectl describe pod <pod-name> | grep -A 10 "Limits"

# 3. åˆ†æåº”ç”¨æ€§èƒ½
# ä½¿ç”¨pprofåˆ†æGoåº”ç”¨
go tool pprof http://localhost:6060/debug/pprof/profile

# ä½¿ç”¨JProfileråˆ†æJavaåº”ç”¨
java -agentpath:/path/to/jprofiler/bin/linux-x64/libjprofilerti.so=port=8849 -jar app.jar
```

## ğŸ“š åŸ¹è®­å’Œèƒ½åŠ›å»ºè®¾ / Training and Capability Building

### åŸ¹è®­è·¯å¾„è®¾è®¡

```mermaid
graph TD
    A[åŸºç¡€çŸ¥è¯†] --> B[å®¹å™¨æŠ€æœ¯]
    A --> C[å¾®æœåŠ¡æ¶æ„]
    B --> D[KubernetesåŸºç¡€]
    C --> D
    D --> E[æœåŠ¡ç½‘æ ¼]
    D --> F[ç›‘æ§è¿ç»´]
    E --> G[é«˜çº§ä¸»é¢˜]
    F --> G
    G --> H[ä¸“å®¶è®¤è¯]
```

### å®è·µé¡¹ç›®å»ºè®®

**åˆçº§é¡¹ç›®**ï¼š

- [ ] å°†ç®€å•Webåº”ç”¨å®¹å™¨åŒ–
- [ ] ä½¿ç”¨Docker Composeç¼–æ’å¤šæœåŠ¡åº”ç”¨
- [ ] é…ç½®åŸºç¡€çš„ç›‘æ§å’Œæ—¥å¿—

**ä¸­çº§é¡¹ç›®**ï¼š

- [ ] åœ¨Kubernetesä¸Šéƒ¨ç½²å¾®æœåŠ¡åº”ç”¨
- [ ] å®æ–½æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†
- [ ] é…ç½®IstioæœåŠ¡ç½‘æ ¼

**é«˜çº§é¡¹ç›®**ï¼š

- [ ] å®ç°å¤šé›†ç¾¤éƒ¨ç½²
- [ ] æ„å»ºCI/CDæµæ°´çº¿
- [ ] å®æ–½æ··æ²Œå·¥ç¨‹æµ‹è¯•

---

**æ–‡æ¡£ç‰ˆæœ¬ä¿¡æ¯**:

- ç‰ˆæœ¬: v1.0
- åˆ›å»ºæ—¥æœŸ: 2024-12-19
- æœ€åæ›´æ–°: 2024-12-19
- ç»´æŠ¤è€…: æŠ€æœ¯å›¢é˜Ÿ
- é€‚ç”¨èŒƒå›´: å®¹å™¨å¾®æœåŠ¡æŠ€æœ¯æ ˆ

**ä½¿ç”¨å»ºè®®**:

1. å»ºè®®æŒ‰é˜¶æ®µæ¨è¿›ï¼Œé¿å…ä¸€æ¬¡æ€§å®æ–½æ‰€æœ‰åŠŸèƒ½
2. é‡è§†å›¢é˜ŸåŸ¹è®­å’ŒæŠ€èƒ½å»ºè®¾
3. å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
4. å®šæœŸå›é¡¾å’Œä¼˜åŒ–æŠ€æœ¯æ–¹æ¡ˆ
