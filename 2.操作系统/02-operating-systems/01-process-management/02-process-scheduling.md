# 进程调度

## 概述

进程调度是操作系统的核心功能，负责从就绪队列中选择下一个要执行的进程，并分配CPU资源。调度算法的选择直接影响系统的性能、响应时间和资源利用率。

## 调度目标

### 主要目标

- **CPU利用率最大化**：保持CPU尽可能忙碌
- **吞吐量最大化**：单位时间内完成的进程数
- **周转时间最小化**：进程从提交到完成的时间
- **等待时间最小化**：进程在就绪队列中的等待时间
- **响应时间最小化**：从请求到首次响应的时间

### 次要目标

- **公平性**：所有进程都有机会获得CPU
- **可预测性**：调度行为可预测
- **可扩展性**：支持大量进程
- **负载平衡**：在多处理器系统中平衡负载

## 调度算法分类

### 抢占式调度

- 进程可以被中断，CPU分配给其他进程
- 响应时间短，适合交互式系统
- 实现复杂，开销较大

### 非抢占式调度

- 进程一旦获得CPU，会一直执行到完成或阻塞
- 实现简单，开销小
- 响应时间长，不适合交互式系统

## 经典调度算法

### 先来先服务（FCFS）

**特点**：

- 非抢占式
- 按进程到达顺序调度
- 实现简单

**优点**：

- 公平
- 实现简单

**缺点**：

- 平均等待时间长
- 对短进程不利
- 可能导致饥饿

**适用场景**：

- 批处理系统
- 简单的嵌入式系统

### 短作业优先（SJF）

**特点**：

- 选择执行时间最短的进程
- 可以是抢占式或非抢占式

**优点**：

- 平均等待时间最短
- 吞吐量高

**缺点**：

- 可能导致饥饿
- 需要预知执行时间
- 实现复杂

**适用场景**：

- 批处理系统
- 已知执行时间的任务

### 优先级调度

**特点**：

- 按优先级选择进程
- 优先级可以是静态或动态

**优点**：

- 灵活
- 可以反映进程重要性

**缺点**：

- 可能导致饥饿
- 优先级设置困难

**适用场景**：

- 实时系统
- 多用户系统

### 轮转调度（RR）

**特点**：

- 抢占式
- 每个进程分配固定时间片
- 时间片用完后被抢占

**优点**：

- 公平
- 响应时间短
- 适合交互式系统

**缺点**：

- 时间片选择困难
- 上下文切换开销大

**适用场景**：

- 分时系统
- 交互式系统

### 多级队列调度

**特点**：

- 将进程分为多个优先级队列
- 不同队列使用不同调度算法
- 高优先级队列优先调度

**优点**：

- 灵活
- 可以适应不同类型进程

**缺点**：

- 实现复杂
- 可能导致饥饿

**适用场景**：

- 通用操作系统
- 多用户系统

### 多级反馈队列调度

**特点**：

- 进程可以在队列间移动
- 根据进程行为调整优先级
- 结合了多种调度算法的优点

**优点**：

- 适应性强
- 平衡了各种调度目标

**缺点**：

- 实现复杂
- 参数设置困难

**适用场景**：

- 现代操作系统
- 通用计算环境

## 实时调度

### 硬实时调度

- 必须满足所有截止时间
- 使用EDF（最早截止时间优先）算法
- 适用于安全关键系统

### 软实时调度

- 尽量满足截止时间
- 偶尔错过截止时间可以接受
- 适用于多媒体系统

## 多处理器调度

### 负载平衡

- 将进程均匀分配到各处理器
- 避免某些处理器过载
- 提高整体性能

### 亲和性调度

- 进程倾向于在同一处理器上运行
- 减少缓存失效
- 提高局部性

## 调度性能评估

### 性能指标

- **CPU利用率**：CPU忙碌时间比例
- **吞吐量**：单位时间完成的进程数
- **周转时间**：进程从提交到完成的时间
- **等待时间**：进程在就绪队列中的等待时间
- **响应时间**：从请求到首次响应的时间

### 评估方法

- **理论分析**：数学建模分析
- **仿真**：使用仿真工具评估
- **实际测试**：在真实系统上测试

## 实际应用

### Linux调度器

- **CFS（完全公平调度器）**：基于虚拟运行时间
- **实时调度器**：支持实时任务
- **多处理器调度**：负载平衡和亲和性

### Windows调度器

- **优先级调度**：32个优先级级别
- **时间片分配**：根据优先级分配时间片
- **多处理器支持**：NUMA感知调度

### macOS调度器

- **基于Mach内核**：支持多种调度策略
- **实时支持**：支持实时任务
- **节能调度**：考虑能耗因素

## 学习目标

1. 理解进程调度的目标和分类
2. 掌握经典调度算法的原理和特点
3. 了解实时调度的要求和方法
4. 理解多处理器调度的挑战
5. 能够评估调度算法的性能
6. 了解实际操作系统中的调度实现

## 相关资源

- 《操作系统概念》
- 《现代操作系统》
- Linux内核调度器源码
- Windows调度器文档

## 实践项目

1. 实现经典调度算法
2. 比较不同调度算法的性能
3. 分析Linux CFS调度器
4. 设计实时调度算法
