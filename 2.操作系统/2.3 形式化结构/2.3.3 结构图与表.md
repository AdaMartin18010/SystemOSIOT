# 操作系统结构图与表 (Operating System Structure Diagrams and Tables)

## 概述 (Overview)

操作系统结构图与表通过图形和表格的形式，直观地展示操作系统的架构、组件关系和层次结构，为理解和分析系统提供可视化的形式化表达。

## 1. 系统架构图 (System Architecture Diagrams)

### 1.1 整体架构图 (Overall Architecture Diagram)

**操作系统层次架构**：

```text
┌─────────────────────────────────────────────────────────────┐
│                    用户应用程序层                              │
│  (Applications: Browser, Office, Games, Development Tools) │
├─────────────────────────────────────────────────────────────┤
│                    系统调用接口层                              │
│  (System Calls: Process, Memory, File, Network, Device)   │
├─────────────────────────────────────────────────────────────┤
│                    操作系统内核层                              │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐ │
│  │  进程管理    │  内存管理    │  文件系统    │  设备管理    │ │
│  │ (Process)   │ (Memory)    │ (File Sys)  │ (Device)    │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│                    硬件抽象层                                 │
│  (Hardware Abstraction: CPU, Memory, I/O, Interrupts)     │
├─────────────────────────────────────────────────────────────┤
│                    硬件层                                    │
│  (Hardware: Processor, RAM, Storage, Network, Devices)    │
└─────────────────────────────────────────────────────────────┘
```

**数学表达**：
$$OS\_Architecture = (User\_Layer, System\_Call\_Layer, Kernel\_Layer, HAL\_Layer, Hardware\_Layer)$$
$$Layer\_Interface = \{(L_i, L_{i+1}) : L_i \text{ provides services to } L_{i+1}\}$$

### 1.2 内核架构图 (Kernel Architecture Diagram)

**宏内核架构**：

```text
┌─────────────────────────────────────────────────────────────┐
│                        宏内核                                │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐ │
│  │  进程调度    │  内存管理    │  文件系统    │  网络协议    │ │
│  │ (Scheduler) │ (Memory)    │ (File Sys)  │ (Network)   │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┘ │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐ │
│  │  设备驱动    │  中断处理    │  系统调用    │  安全机制    │ │
│  │ (Drivers)   │ (Interrupt) │ (Syscall)   │ (Security)  │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│                        硬件层                                │
└─────────────────────────────────────────────────────────────┘
```

**微内核架构**：

```text
┌─────────────────────────────────────────────────────────────┐
│                      用户空间                                │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐ │
│  │  文件服务    │  网络服务    │  设备服务    │  安全服务    │ │
│  │ (File Serv) │ (Net Serv)  │ (Dev Serv)  │ (Sec Serv)  │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│                      微内核                                  │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐ │
│  │  进程间通信  │  内存管理    │  进程管理    │  基本调度    │ │
│  │ (IPC)       │ (Memory)    │ (Process)   │ (Scheduler) │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│                        硬件层                                │
└─────────────────────────────────────────────────────────────┘
```

### 1.3 进程状态转换图 (Process State Transition Diagram)

**进程状态图**：

```text
                    ┌─────────┐
                    │   New   │
                    └────┬────┘
                         │ Create
                    ┌────▼────┐
                    │  Ready   │◄─────┐
                    └────┬────┘      │
                         │ Schedule  │ Wake
                    ┌────▼────┐      │
                    │ Running  │─────┘
                    └────┬────┘
                         │ Block
                    ┌────▼────┐
                    │ Blocked  │
                    └────┬────┘
                         │ Terminate
                    ┌────▼────┐
                    │Terminated│
                    └─────────┘
```

**状态转换表**：

| 当前状态 | 事件 | 下一状态 | 条件 |
|----------|------|----------|------|
| New | Create | Ready | 进程创建完成 |
| Ready | Schedule | Running | CPU可用 |
| Running | Block | Blocked | 等待I/O |
| Running | Time Slice | Ready | 时间片用完 |
| Running | Terminate | Terminated | 进程结束 |
| Blocked | Wake | Ready | I/O完成 |

## 2. 内存管理图 (Memory Management Diagrams)

### 2.1 虚拟内存映射图 (Virtual Memory Mapping Diagram)

**地址转换图**：

```text
虚拟地址空间 (32位)                   物理地址空间 (24位)
┌─────────────────────────────────┐    ┌─────────────────┐
│ 0x00000000                     │    │ 0x000000        │
│ ┌─────────────────────────────┐ │    │ ┌─────────────┐ │
│ │        用户空间              │ │    │ │   进程A     │ │
│ │     (0x00000000-0x7FFFFFFF) │ │    │ │   Page 0    │ │
│ └─────────────────────────────┘ │    │ └─────────────┘ │
│ 0x80000000                     │    │ 0x001000        │
│ ┌─────────────────────────────┐ │    │ ┌─────────────┐ │
│ │        内核空间              │ │    │ │   进程B     │ │
│ │     (0x80000000-0xFFFFFFFF) │ │    │ │   Page 1    │ │
│ └─────────────────────────────┘ │    │ └─────────────┘ │
└─────────────────────────────────┘    │ 0x002000        │
                                       │ ┌─────────────┐ │
                                       │ │   进程C     │ │
                                       │ │   Page 2    │ │
                                       │ └─────────────┘ │
                                       └─────────────────┘
```

**页表结构**：

```text
虚拟地址: 0x12345678
┌─────────────────────────────────────────────────────────────┐
│ 页号 (Page Number) │ 页内偏移 (Page Offset)                │
│ 0x12345           │ 0x678                                 │
└─────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────┐
│ 页表 (Page Table)                                          │
├─────────────────────────────────────────────────────────────┤
│ 页号 │ 帧号 │ 有效位 │ 保护位 │ 访问位 │ 修改位 │ 其他位 │
├──────┼──────┼───────┼───────┼───────┼───────┼───────┤
│0x1234│ 0x5  │   1   │   RW  │   1   │   0   │   0   │
│0x1235│ 0x8  │   1   │   R   │   1   │   1   │   0   │
│0x1236│  -   │   0   │   -   │   -   │   -   │   -   │
└──────┴──────┴───────┴───────┴───────┴───────┴───────┘
```

### 2.2 内存分配图 (Memory Allocation Diagram)

**内存分配状态**：

```text
物理内存布局
┌─────────────────────────────────────────────────────────────┐
│ 0x00000000                                                 │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│ │   进程A     │ │   进程B     │ │   进程C     │          │
│ │  4KB Page   │ │  8KB Page   │ │  2KB Page   │          │
│ │  (Allocated)│ │  (Allocated)│ │  (Allocated)│          │
│ └─────────────┘ └─────────────┘ └─────────────┘          │
│ 0x00001000    0x00003000    0x00005000                   │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│ │   空闲块    │ │   空闲块    │ │   空闲块    │          │
│ │  6KB Free   │ │  4KB Free   │ │  10KB Free  │          │
│ └─────────────┘ └─────────────┘ └─────────────┘          │
│ 0x00002000    0x00004000    0x00006000                   │
└─────────────────────────────────────────────────────────────┘
```

**空闲链表**：

```text
空闲块链表
┌─────────────┬─────────────┬─────────────┬─────────────┐
│ 起始地址    │ 大小        │ 状态        │ 下一块      │
├─────────────┼─────────────┼─────────────┼─────────────┤
│ 0x00002000  │ 6KB         │ Free        │ 0x00004000  │
│ 0x00004000  │ 4KB         │ Free        │ 0x00006000  │
│ 0x00006000  │ 10KB        │ Free        │ NULL        │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

## 3. 调度系统图 (Scheduling System Diagrams)

### 3.1 调度队列图 (Scheduling Queue Diagram)

**多级反馈队列**：

```text
调度队列层次结构
┌─────────────────────────────────────────────────────────────┐
│                    调度器 (Scheduler)                        │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │  队列1      │  │  队列2      │  │  队列3      │      │
│  │ (Priority 1)│  │ (Priority 2)│  │ (Priority 3)│      │
│  │ Time Slice  │  │ Time Slice  │  │ Time Slice  │      │
│  │ = 8ms       │  │ = 16ms      │  │ = 32ms      │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │ 进程A,B,C   │  │ 进程D,E     │  │ 进程F,G     │      │
│  │ (Ready)     │  │ (Ready)     │  │ (Ready)     │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
├─────────────────────────────────────────────────────────────┤
│                    就绪队列 (Ready Queue)                   │
└─────────────────────────────────────────────────────────────┘
```

**调度算法比较表**：

| 算法 | 公平性 | 效率 | 响应时间 | 吞吐量 | 饥饿问题 |
|------|--------|------|----------|--------|----------|
| FCFS | 高 | 低 | 高 | 低 | 无 |
| SJF | 低 | 高 | 低 | 高 | 有 |
| RR | 高 | 中 | 中 | 中 | 无 |
| Priority | 低 | 中 | 低 | 中 | 有 |
| MLFQ | 中 | 高 | 中 | 高 | 无 |

### 3.2 实时调度图 (Real-Time Scheduling Diagram)

**实时任务调度**：

```text
实时任务时间线
时间轴: 0ms    10ms   20ms   30ms   40ms   50ms   60ms
        │       │      │      │      │      │      │
任务A:  ┌───────┐      ┌───────┐      ┌───────┐
        │ 执行  │      │ 执行  │      │ 执行  │
        └───────┘      └───────┘      └───────┘
任务B:        ┌───────┐      ┌───────┐      ┌───────┐
              │ 执行  │      │ 执行  │      │ 执行  │
              └───────┘      └───────┘      └───────┘
任务C:              ┌───────┐      ┌───────┐
                    │ 执行  │      │ 执行  │
                    └───────┘      └───────┘
```

**可调度性分析表**：

| 任务 | 周期(T) | 执行时间(C) | 截止时间(D) | C/T | 可调度性 |
|------|---------|-------------|-------------|-----|----------|
| A | 20ms | 5ms | 20ms | 0.25 | ✓ |
| B | 30ms | 10ms | 30ms | 0.33 | ✓ |
| C | 60ms | 15ms | 60ms | 0.25 | ✓ |
| 总计 | - | - | - | 0.83 | ✓ |

## 4. 文件系统图 (File System Diagrams)

### 4.1 文件系统层次图 (File System Hierarchy Diagram)

**文件系统结构**：

```text
根目录 (/)
├── bin/          (系统命令)
│   ├── ls
│   ├── cp
│   └── mv
├── etc/          (配置文件)
│   ├── passwd
│   ├── hosts
│   └── fstab
├── home/         (用户目录)
│   ├── user1/
│   │   ├── Documents/
│   │   ├── Pictures/
│   │   └── Downloads/
│   └── user2/
│       ├── Projects/
│       └── Backup/
├── var/          (可变数据)
│   ├── log/
│   ├── cache/
│   └── tmp/
└── dev/          (设备文件)
    ├── sda
    ├── tty
    └── null
```

**inode结构**：

```text
inode 结构 (128字节)
┌─────────────────────────────────────────────────────────────┐
│ 文件类型 (2字节) │ 权限 (2字节) │ 用户ID (2字节) │ 组ID (2字节) │
├─────────────────────────────────────────────────────────────┤
│ 文件大小 (4字节) │ 最后访问时间 (4字节) │ 最后修改时间 (4字节) │
├─────────────────────────────────────────────────────────────┤
│ 最后状态改变时间 (4字节) │ 链接数 (2字节) │ 设备ID (2字节) │
├─────────────────────────────────────────────────────────────┤
│ 直接块指针 (12个 × 4字节 = 48字节)                        │
├─────────────────────────────────────────────────────────────┤
│ 一级间接块指针 (4字节) │ 二级间接块指针 (4字节) │ 三级间接块指针 (4字节) │
├─────────────────────────────────────────────────────────────┤
│ 保留字段 (4字节)                                          │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 文件分配表 (File Allocation Table)

**FAT表结构**：

```text
FAT (File Allocation Table)
┌─────────────┬─────────────┬─────────────┬─────────────┐
│ 簇号        │ 下一簇      │ 状态        │ 文件        │
├─────────────┼─────────────┼─────────────┼─────────────┤
│ 0           │ 0xFFFF      │ 空闲        │ -           │
│ 1           │ 2           │ 已分配      │ file1.txt   │
│ 2           │ 4           │ 已分配      │ file1.txt   │
│ 3           │ 0xFFFF      │ 空闲        │ -           │
│ 4           │ 6           │ 已分配      │ file1.txt   │
│ 5           │ 0xFFFF      │ 空闲        │ -           │
│ 6           │ 0xFFFF      │ 已分配      │ file1.txt   │
│ 7           │ 8           │ 已分配      │ file2.txt   │
│ 8           │ 0xFFFF      │ 已分配      │ file2.txt   │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

## 5. 网络协议图 (Network Protocol Diagrams)

### 5.1 协议栈图 (Protocol Stack Diagram)

**TCP/IP协议栈**：

```text
应用层 (Application Layer)
┌─────────────────────────────────────────────────────────────┐
│ HTTP │ FTP │ SMTP │ DNS │ Telnet │ SSH │ 其他应用协议    │
└─────────────────────────────────────────────────────────────┘
传输层 (Transport Layer)
┌─────────────────────────────────────────────────────────────┐
│ TCP (Transmission Control Protocol)                        │
│ UDP (User Datagram Protocol)                              │
└─────────────────────────────────────────────────────────────┘
网络层 (Network Layer)
┌─────────────────────────────────────────────────────────────┐
│ IP (Internet Protocol) │ ICMP │ ARP │ 路由协议            │
└─────────────────────────────────────────────────────────────┘
数据链路层 (Data Link Layer)
┌─────────────────────────────────────────────────────────────┐
│ Ethernet │ WiFi │ PPP │ 其他链路层协议                     │
└─────────────────────────────────────────────────────────────┘
物理层 (Physical Layer)
┌─────────────────────────────────────────────────────────────┐
│ 电缆 │ 光纤 │ 无线 │ 其他物理介质                          │
└─────────────────────────────────────────────────────────────┘
```

**数据封装过程**：

```text
应用数据
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ HTTP Header │ Application Data                             │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ TCP Header │ HTTP Header │ Application Data               │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ IP Header │ TCP Header │ HTTP Header │ Application Data  │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ Ethernet Header │ IP Header │ TCP Header │ HTTP Header │ App Data │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 网络连接状态图 (Network Connection State Diagram)

**TCP连接状态**：

```text
TCP连接状态机
                    ┌─────────┐
                    │ CLOSED  │
                    └────┬────┘
                         │
                    ┌────▼────┐
                    │ LISTEN  │
                    └────┬────┘
                         │ SYN
                    ┌────▼────┐
                    │SYN_RCVD │
                    └────┬────┘
                         │ ACK
                    ┌────▼────┐
                    │ESTABLISHED│
                    └────┬────┘
                         │ FIN
                    ┌────▼────┐
                    │FIN_WAIT1│
                    └────┬────┘
                         │ ACK
                    ┌────▼────┐
                    │FIN_WAIT2│
                    └────┬────┘
                         │ FIN
                    ┌────▼────┐
                    │TIME_WAIT│
                    └────┬────┘
                         │ 2MSL
                    ┌────▼────┐
                    │ CLOSED  │
                    └─────────┘
```

## 6. 安全模型图 (Security Model Diagrams)

### 6.1 访问控制矩阵 (Access Control Matrix)

**访问控制表**：

```text
访问控制矩阵 (ACM)
┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐
│ 主体/客体   │ file1.txt   │ file2.txt   │ /dev/sda    │ /etc/passwd │
├─────────────┼─────────────┼─────────────┼─────────────┼─────────────┤
│ user1       │ rw-         │ r--         │ ---         │ r--         │
│ user2       │ ---         │ rw-         │ ---         │ r--         │
│ admin       │ rw-         │ rw-         │ rw-         │ rw-         │
│ system      │ r--         │ r--         │ rw-         │ r--         │
└─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘

权限说明:
r = read (读)
w = write (写)
x = execute (执行)
- = no permission (无权限)
```

**安全级别层次**：

```text
安全级别层次结构
┌─────────────────────────────────────────────────────────────┐
│                    绝密 (Top Secret)                        │
├─────────────────────────────────────────────────────────────┤
│                    机密 (Secret)                            │
├─────────────────────────────────────────────────────────────┤
│                    秘密 (Confidential)                      │
├─────────────────────────────────────────────────────────────┤
│                    内部 (Internal)                          │
├─────────────────────────────────────────────────────────────┤
│                    公开 (Public)                            │
└─────────────────────────────────────────────────────────────┘
```

## 7. 性能分析图 (Performance Analysis Diagrams)

### 7.1 性能指标图 (Performance Metrics Diagram)

**系统性能指标**：

```text
性能指标雷达图
                    CPU利用率
                       │
                       │ 80%
                       │
                       │
内存利用率 ─────────────┼───────────── 响应时间
   60%                 │                 50ms
                       │
                       │
                       │
                       │
                   吞吐量
                   1000 req/s
```

**性能监控表**：

| 指标 | 当前值 | 阈值 | 状态 | 趋势 |
|------|--------|------|------|------|
| CPU利用率 | 75% | 80% | 警告 | ↗ |
| 内存利用率 | 60% | 85% | 正常 | → |
| 磁盘I/O | 45MB/s | 100MB/s | 正常 | ↘ |
| 网络带宽 | 80% | 90% | 警告 | ↗ |
| 响应时间 | 50ms | 100ms | 正常 | → |

### 7.2 资源利用图 (Resource Utilization Diagram)

**资源利用时间线**：

```text
资源利用时间线 (24小时)
时间: 00:00  06:00  12:00  18:00  24:00
      │       │       │       │       │
CPU:  ████████░░░░░░░░████████░░░░░░░░████████
      100%    20%     100%    20%     100%
      │       │       │       │       │
内存: ████████░░░░░░░░████████░░░░░░░░████████
      80%     40%     80%     40%     80%
      │       │       │       │       │
磁盘: ██░░░░░░██████████░░░░░░██████████░░░░░░
      30%     70%     30%     70%     30%
      │       │       │       │       │
网络: ██░░░░░░██████████░░░░░░██████████░░░░░░
      25%     75%     25%     75%     25%
```

## 8. 总结 (Summary)

操作系统结构图与表提供了：

1. **可视化表达**：通过图形直观展示系统结构
2. **关系清晰**：明确展示组件间的关系和层次
3. **数据完整**：通过表格提供详细的数据信息
4. **分析支持**：为系统分析和优化提供可视化工具

这些图表为理解操作系统结构提供了重要的可视化支持。

---

*本文档通过图形和表格的形式展示了操作系统的结构，为深入理解系统架构提供了可视化表达。*
