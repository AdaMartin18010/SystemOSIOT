# 策略回放用例库（NSX × CNI × 应用）

## 1. 目的

- 将源策略转译为 NSX/CNI 工件并回放验证，确保跨层一致性与无阴影规则。

## 2. 用例结构

- 元数据：ID、标签、适用环境、前置依赖。
- 源策略：意图描述（主体/客体/动作/条件）。
- 生成工件：NSX Policy/DFW、K8s NetworkPolicy、Ingress 等。
- 验证：流量生成参数、预期 verdict、观测点与日志。

## 3. 示例（摘要）

- 用例：命名空间 A 仅访问 B 的 443/tcp
  - 源策略：allow A→B:443；deny others
  - 工件：K8s NetworkPolicy + NSX DFW Section
  - 验证：curl/hey，Hubble/Traceflow verdict = allow

- 用例：服务 C 仅出站访问公网 HTTP 代理
  - 源策略：allow C→Proxy；deny egress others
  - 工件：Egress Gateway/DFW 规则
  - 验证：pcap + eBPF 流计数

## 4. 自动化

- Pipeline：源策略（Git）→ 生成器 → 部署 → 回放 → 报告
- 指标：覆盖率、误阻断率、回放时长、变更漂移
